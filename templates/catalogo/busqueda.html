{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados de búsqueda</title>
    <link rel="stylesheet" href="{% static 'css/estilo.css' %}">
</head>
<body class="catalogo">
<header class="hero hero--detalle">
    <div class="hero__nav contenedor">
        <div class="brand">
            <img class="brand__logo" src="{% static 'images/logoZHPfinalSinFondo.png' %}" alt="Logo Zapatería Hermanos Parera">
            <div>
                <h1>Búsqueda de productos</h1>
            </div>
        </div>
        <div class="hero__actions">
            <a class="boton boton--outline" href="{% url 'home' %}">Inicio</a>
            <a class="boton" href="{% url 'lista-productos' %}">Catálogo completo</a>
        </div>
    </div>
    <div class="hero__content contenedor">
        <div class="hero__text">
        </div>
    </div>
</header>

<main class="contenedor seccion catalogo-busqueda">
    <section class="busqueda-panel">
        <div class="busqueda-panel__body">
            <div>
                <p class="section-eyebrow">Búsqueda rápida</p>
                {% if termino %}
                    <h2>Mostrando resultados para “{{ termino }}”</h2>
                {% else %}
                    <h2>Introduce un término para buscar productos</h2>
                {% endif %}
            </div>
            <div class="hero__search">
                {% include "includes/buscador_global.html" with input_id="busqueda-catalogo-principal" initial_query=termino %}
            </div>
        </div>
        <div class="busqueda-panel__summary">
            <p>Resultados encontrados: <strong>{{ num_resultados }}</strong></p>
        </div>
    </section>

    <section class="catalogo-principal catalogo-principal--full">
        {% if productos %}
            <div class="grid catalogo__grid">
                {% for producto in productos %}
                    <article class="tarjeta producto {% if producto.stock|default:0 <= 0 %}producto--agotado{% endif %}">
                        <a class="producto__imagen" href="{% url 'detalle-producto' producto.id %}">
                            {% with thumb=producto.imagen_destacada %}
                                {% if thumb %}
                                    <img src="{{ thumb.imagen.url }}" alt="{{ producto.nombre }}">
                                {% else %}
                                    <img src="{% static 'images/placeholder.svg' %}" alt="Sin imagen disponible">
                                {% endif %}
                            {% endwith %}
                            {% if producto.stock|default:0 <= 0 %}
                                <span class="producto__badge producto__badge--agotado">Agotado</span>
                            {% endif %}
                        </a>
                        <div class="producto__contenido">
                            <p class="producto__categoria">{{ producto.categoria.seccion.departamento.nombre }} → {{ producto.categoria.nombre }}</p>
                            <h2>
                                <a href="{% url 'detalle-producto' producto.id %}">
                                    {{ producto.nombre }}
                                </a>
                            </h2>
                            <div class="producto__precio">
                                {% if producto.precio_oferta %}
                                    <span class="precio-actual">{{ producto.precio_oferta }} €</span>
                                    <span class="precio-tachado">{{ producto.precio }} €</span>
                                {% else %}
                                    <span class="precio-actual">{{ producto.precio }} €</span>
                                {% endif %}
                            </div>
                            <div class="producto__acciones">
                                <a class="boton boton--outline" href="{% url 'detalle-producto' producto.id %}">Ver detalles</a>
                            </div>
                            <form class="busqueda-add-form" action="{% url 'agregar-al-carrito' producto.id %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="cantidad" value="1">
                                <button class="boton boton--ghost" type="submit">Añadir a la cesta</button>
                            </form>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <section class="estado-vacio">
                <div>
                    <p>No encontramos productos que coincidan con tu búsqueda.</p>
                    <p>Prueba con otro término.</p>
                    <a class="boton" href="{% url 'buscar-productos' %}">Nueva búsqueda</a>
                </div>
            </section>
        {% endif %}
    </section>
</main>

{% include "includes/footer_no_devoluciones.html" %}
</body>
</html>
