{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zapatería Hermanos Parera</title>
    <link rel="stylesheet" href="{% static 'css/estilo.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="landing">
    <div class="landing__wrapper">
        <header class="landing-header">
            <nav class="landing-navbar">
                <div class="landing-navbar__brand">
                    <img class="nav-logo" src="{% static 'images/logoZHPfinalSinFondo.png' %}" alt="Logo Zapatería Hermanos Parera">
                    <span>Zapatería Hermanos Parera</span>
                </div>
                <div class="landing-navbar__links">
                    <a href="{% url 'home' %}#acerca">Acerca</a>
                    <a href="{% url 'home' %}#categorias">Categorías</a>
                    <a href="{% url 'lista-productos' %}">Catálogo</a>
                    <a href="{% url 'home' %}#contacto">Contacto</a>
                </div>
                <div class="landing-navbar__actions">
                    <div class="landing-user" id="landing-user" aria-live="polite">
                        <span id="landing-user-label">Sesión no iniciada</span>
                        <button type="button" class="boton boton--ghost landing-user__logout" id="logout-btn" hidden>Cerrar sesión</button>
                    </div>
                    <a class="landing-cart-link" href="#seguimiento" aria-label="Ir a seguimiento de pedido">Seguimiento</a>
                    <a class="landing-cart-link" href="{% url 'carrito' %}" aria-label="Ir al carrito">
                        <span>Carrito</span>
                        <svg class="landing-cart-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M3 4h2l2.7 11.3a1.5 1.5 0 0 0 1.47 1.2h7.88a1.5 1.5 0 0 0 1.46-1.09L20.6 7H6.12"
                                  fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                                  stroke-linejoin="round" />
                            <circle cx="10" cy="20" r="1.4" />
                            <circle cx="17" cy="20" r="1.4" />
                        </svg>
                    </a>
                </div>
            </nav>

            <div class="landing-hero">
                <div class="landing-hero__text">
                    <h1 class="landing-hero__title">Con los Parera, zapatos para cualquiera.</h1>
                    <p class="landing-hero__description">
                        Somos una boutique especializada en sneakers y calzado deportivo premium. Traemos lanzamientos globales a la puerta de tu casa
                        y enviamos a todo el país.
                    </p>
                    <div class="hero__cta">
                        <a class="boton" href="{% url 'lista-productos' %}">Ver catálogo</a>
                        <a class="landing-cart-link" href="#seguimiento">Seguimiento de pedido</a>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section id="accesos" class="landing-section">
                <div class="landing-section__header">
                    <h2 class="section-heading">Elige tu próxima acción.</h2>
                </div>
                <div class="landing-card-grid">
                    <article class="landing-card">
                        <h3>Acerca de</h3>
                        <p>Conocenos, nuestra historia y compromiso con el calzado deportivo.</p>
                        <a href="{% url 'home' %}#acerca">Ver más</a>
                    </article>
                    <article class="landing-card">
                        <h3>Contacto</h3>
                        <p>Contacta con nosotros.</p>
                        <a href="{% url 'home' %}#contacto">Contactar</a>
                    </article>
                    <article class="landing-card">
                        <h3>Categorías</h3>
                        <p>Explora nuestra amplia variedad de calzado deportivo premium.</p>
                        <a href="{% url 'home' %}#categorias">Descubrir</a>
                    </article>
                    <article class="landing-card">
                        <h3>Catálogo</h3>
                        <p>Mira la lista completa de productos disponibles y ediciones limitadas.</p>
                        <a href="{% url 'lista-productos' %}">Ir ahora</a>
                    </article>
                    <article class="landing-card" id="carrito">
                        <h3>Carrito de la compra</h3>
                        <p>Administra tus compras y finaliza pedidos con envíos asegurados.</p>
                        <a href="{% url 'home' %}#carrito-panel">Gestionar</a>
                    </article>
                    <article class="landing-card" id="identificacion">
                        <h3>Identificación</h3>
                        <p>Inicia sesión para ver tus pedidos.</p>
                        <a href="{% url 'home' %}#identificacion-panel">Ingresar</a>
                    </article>
                    <article class="landing-card" id="registro">
                        <h3>Registro</h3>
                        <p>Únete al Club Parera y recibe avances sobre lanzamientos exclusivos.</p>
                        <a href="{% url 'home' %}#registro-panel">Crear cuenta</a>
                    </article>
                    <article class="landing-card" id="seguimiento-card">
                        <h3>Seguimiento de pedido</h3>
                        <p>Consulta el estado de tu compra con tu número de pedido.</p>
                        <a href="#seguimiento">Ir a seguimiento</a>
                    </article>
                </div>
            </section>

            <section id="acerca" class="landing-section">
                <div class="landing-section__header">
                    <p class="section-eyebrow">Acerca de nosotros</p>
                    <h2 class="section-heading">Tradición familiar, espíritu deportivo.</h2>
                    <p class="section-description">
                        Tres generaciones de Pareras dedicados al calzado deportivo de la más alta calidad. 
                        Desde nuestros inicios, la tienda se ha centrado en ofrecer productos cuidadosamente seleccionados y un servicio cercano, 
                        combinando experiencia, profesionalidad y compromiso con el cliente.
                    </p>
                </div>
            </section>

            <section id="categorias" class="landing-section">
                <div class="landing-section__header">
                    <h2 class="section-heading">Categorías</h2>
                </div>
                <div class="landing-card-grid">
                    <article class="landing-card">
                        <h3>Categoria X</h3>
                        <p>Lo que sea.</p>
                        <a href="{% url 'lista-productos' %}?categoria=performance">Explorar</a>
                    </article>
                    <article class="landing-card">
                        <h3>Categoria X</h3>
                        <p>Lo que sea.</p>
                        <a href="{% url 'lista-productos' %}?categoria=streetwear">Ver línea</a>
                    </article>
                    <article class="landing-card">
                        <h3>Categoria X</h3>
                        <p>Lo que sea.</p>
                        <a href="{% url 'lista-productos' %}?categoria=premium">Descubrir</a>
                    </article>
                    <article class="landing-card">
                        <h3>Categoria X</h3>
                        <p>Lo que sea.</p>
                        <a href="{% url 'lista-productos' %}?categoria=kids">Conocer</a>
                    </article>
                </div>
            </section>

            <section id="carrito-panel" class="landing-section">
                <div class="landing-panel">
                    <p class="section-eyebrow">Carrito de la compra</p>
                    <h2 class="section-heading">Tu selección, siempre a mano.</h2>
                    <a class="boton" href="{% url 'lista-productos' %}">Seguir comprando</a>
                </div>
            </section>

            <section id="seguimiento" class="landing-section">
                <div class="landing-panel">
                    <p class="section-eyebrow">Seguimiento</p>
                    <h2 class="section-heading">Consulta tu pedido</h2>
                    <form class="landing-form" action="{% url 'pedidos:api-pedido-detalle' numero_pedido='PLACEHOLDER' %}" method="get" onsubmit="this.action=this.action.replace('PLACEHOLDER', encodeURIComponent(this.numero_pedido.value.trim()));">
                        <input type="text" name="numero_pedido" placeholder="Número de pedido" required>
                        <button class="boton" type="submit">Ver pedido</button>
                    </form>
                </div>
            </section>

            <section id="identificacion-panel" class="landing-section">
                <div class="landing-panel">
                    <p class="section-eyebrow">Identificación</p>
                    <h2 class="section-heading">Bienvenido de nuevo.</h2>
                    <form class="landing-form" id="login-form">
                        <input type="email" name="email" placeholder="Correo electrónico" required>
                        <input type="password" name="password" placeholder="Contraseña" required>
                        <button class="boton" type="submit">Iniciar sesión</button>
                        <div class="landing-form__feedback" id="login-msg"></div>
                    </form>
                </div>
            </section>

            <section id="registro-panel" class="landing-section">
                <div class="landing-panel">
                    <p class="section-eyebrow">Registro</p>
                    <h2 class="section-heading">Únete al team Parera.</h2>
                    <form class="landing-form" id="registro-form">
                        <input type="text" name="nombre" placeholder="Nombre completo">
                        <input type="email" name="email" placeholder="Correo electrónico" required>
                        <input type="password" name="password" placeholder="Crea una contraseña" required>
                        <button class="boton boton--outline" type="submit">Registrarme</button>
                        <div class="landing-form__feedback" id="registro-msg"></div>
                    </form>
                </div>
            </section>

            <section id="contacto" class="landing-section">
            <div class="landing-section__header">
                    <h2 class="section-heading">Contacto</h2>
                </div>
                <div class="landing-contact-grid">
                    <article class="landing-contact-card">
                        <h3>Tienda física</h3>
                        <p>De lunes a sábado, 9 a 20 h.</p>
                        <p>Av. de la Reina Mercedes, 67, 41012 Sevilla</p>
                    </article>
                    <article class="landing-contact-card">
                        <h3>Número de contacto</h3>
                        <p>+34 954 777 777</p>
                    </article>
                    <article class="landing-contact-card">
                        <h3>Email</h3>
                        <p>zapateriahp@hermanosparera.com</p>
                        <p>Para todo tipo de consultas.</p>
                    </article>
                </div>
            </section>
        </main>

        <footer class="landing-footer">
            <p>&copy; 2025 Zapatería Hermanos Parera. Con los Parera, zapatos para cualquiera.</p>
        </footer>
    </div>
    <script>
        (function () {
            const apiBase = "/api/";
            const userLabel = document.getElementById("landing-user-label");
            const logoutBtn = document.getElementById("logout-btn");

            const setMessage = (el, text, ok = false) => {
                if (!el) return;
                el.textContent = text || "";
                el.style.color = ok ? "green" : "red";
            };

            const updateUserUI = () => {
                const token = localStorage.getItem("token");
                const email = localStorage.getItem("email");
                if (token) {
                    userLabel.textContent = email ? `Sesión: ${email}` : "Sesión iniciada";
                    logoutBtn.hidden = false;
                } else {
                    userLabel.textContent = "Sesión no iniciada";
                    logoutBtn.hidden = true;
                }
            };

            const handleAuthSubmit = (formId, msgId, endpoint) => {
                const form = document.getElementById(formId);
                const msg = document.getElementById(msgId);
                if (!form) return;

                form.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    setMessage(msg, "Procesando...");
                    const formData = new FormData(form);
                    const email = (formData.get("email") || "").trim();
                    const password = formData.get("password") || "";

                    if (!email || !password) {
                        setMessage(msg, "Completa email y contraseña.");
                        return;
                    }

                    try {
                        const response = await fetch(apiBase + endpoint, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ email, password }),
                        });
                        const data = await response.json();
                        if (!response.ok) {
                            const errorMsg =
                                data?.email?.[0] ||
                                data?.non_field_errors?.[0] ||
                                data?.detail ||
                                "No se pudo completar la operación.";
                            setMessage(msg, errorMsg);
                            return;
                        }
                        if (data.token) {
                            localStorage.setItem("token", data.token);
                            localStorage.setItem("email", data.email || email);
                        }
                        setMessage(
                            msg,
                            endpoint === "registro/"
                                ? "Registro completado. Token guardado."
                                : "Inicio de sesión correcto. Token guardado.",
                            true
                        );
                        updateUserUI();
                    } catch (err) {
                        setMessage(msg, "Error de conexión. Inténtalo de nuevo.");
                    }
                });
            };

            if (logoutBtn) {
                logoutBtn.addEventListener("click", () => {
                    localStorage.removeItem("token");
                    localStorage.removeItem("email");
                    updateUserUI();
                });
            }

            handleAuthSubmit("registro-form", "registro-msg", "registro/");
            handleAuthSubmit("login-form", "login-msg", "login/");
            updateUserUI();
        })();
    </script>
</body>

</html>
